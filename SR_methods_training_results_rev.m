xticks = 3:3:12;
yticks_acc = 0:0.5:1;
y_ticks_count = 0:50:100;
tickLabelFont = 'arial';
tickLabelFontSize = 9;
axisLabelFont = 'arial';
axisLabelFontSize = 10;
lineWidth = 0.5;
markerSize = 3;
indMarkerStyle{1} = 'x';
indMarkerStyle{2} = 's';
indMarkerStyle{3} = 'o';
indMarkerStyle{4} = '*';


indLineStyle{1} = '-';
indLineStyle{2} = '--';
indLineStyle{3} = ':';
indLineStyle{4} = '-.';



numReachThreshold = 10;
cdf_color = [0.5,0.5,0.5];

figProps.m = 2;
figProps.n = 2;
figProps.width = 2.54 * 8.5;
figProps.height = 2.54 * 11;
panelSize = 3;
figProps.panelWidth = ones(figProps.n,1) * panelSize;
figProps.panelHeight = ones(figProps.m,1) * panelSize;
figProps.colSpacing = 1.5;
figProps.rowSpacing = 1;
figProps.topMargin = 3;

[h_fig, h_axes] = createFigPanels5(figProps);





h_anyFig = openfig('/Users/dleventh/Box Sync/Leventhal Lab/Manuscripts/Skilled reaching methods/DKL review/anyReachSuccess_2.fig');
h_anySuccess_axes = get(h_anyFig,'children');
h_anySuccess = get(h_anySuccess_axes,'children');
any_succ_day = get(h_anySuccess, 'XData');
any_succ = get(h_anySuccess, 'YData');
any_succ_day = any_succ_day{1};
any_succ = cell2mat(any_succ);
any_succ = any_succ(3:end,:);   % first two rows are the means in the graph
mean_any_succ = mean(any_succ);
std_any_succ = std(any_succ,0,1);
SEM_any_succ = std_any_succ / sqrt(size(any_succ,1));
figure(h_fig)
axes(h_axes(2,2));
% make error bars point down
errorbar(any_succ_day,mean_any_succ,zeros(1,length(SEM_any_succ)),SEM_any_succ,...
         'color','k',...
         'linewidth',lineWidth,...
         'marker','x',...
         'markersize',markerSize);

% set(gca,'ylim',[0 1],...
%         'xlim',[0, max(any_succ_day)+1],...
%         'xtick',xticks,...
%         'ytick',yticks_acc,...
%         'fontname',tickLabelFont,...
%         'fontsize',tickLabelFontSize);

% ylabel('success rate','fontname',axisLabelFont,'fontsize',axisLabelFontSize);
% xlabel('training day','fontname',axisLabelFont,'fontsize',axisLabelFontSize);


h_firstFig = openfig('/Users/dleventh/Box Sync/Leventhal Lab/Manuscripts/Skilled reaching methods/DKL review/firstReachSuccess_2.fig');
h_firstSuccess_axes = get(h_firstFig,'children');
h_firstSuccess = get(h_firstSuccess_axes,'children');
first_succ_day = get(h_firstSuccess, 'XData');
first_succ_day = first_succ_day{1};
first_succ = get(h_firstSuccess, 'YData');
first_succ = cell2mat(first_succ);
first_succ = first_succ(3:end,:);   % first two rows are the means in the graph
mean_first_succ = mean(first_succ);
std_first_succ = std(first_succ,0,1);
SEM_first_succ = std_first_succ / sqrt(size(first_succ,1));
figure(h_fig)
axes(h_axes(2,2));
hold on
errorbar(first_succ_day,mean_first_succ,SEM_first_succ,zeros(1,length(SEM_first_succ)),...
         'color','k',...
         'linestyle','-.',...
         'linewidth',lineWidth,...
         'marker','o',...
         'markersize',markerSize);
set(gca,'ylim',[0 1],...
        'xlim',[0, max(first_succ_day)+1],...
        'xtick',xticks,...
        'ytick',yticks_acc,...
        'fontname',tickLabelFont,...
        'fontsize',tickLabelFontSize);
ylabel('success rate','fontname',axisLabelFont,'fontsize',axisLabelFontSize);
xlabel('training day','fontname',axisLabelFont,'fontsize',axisLabelFontSize);
legend('any reach','first reach',...
       'location','northwest',...
       'fontname',tickLabelFont,...
       'fontsize',tickLabelFontSize);
legend('boxoff')

h_numReachFig = openfig('/Users/dleventh/Box Sync/Leventhal Lab/Manuscripts/Skilled reaching methods/DKL review/reaches_2.fig');
h_numReaches_axes = get(h_numReachFig,'children');
h_numReaches = get(h_numReaches_axes,'children');
num_reaches_day = get(h_numReaches, 'XData');
num_reaches_day = num_reaches_day{1};
num_reaches = get(h_numReaches, 'YData');
for ii = 3 : length(num_reaches)        % to make dimensions match for cell2mat
    num_reaches{ii} = num_reaches{ii}(1:12);
end
% num_reaches{1} = [num_reaches{1},0,0];   % to make dimensions match for cell2mat
% num_reaches{2} = [num_reaches{2},0,0];   % to make dimensions match for cell2mat
num_reaches = cell2mat(num_reaches);
num_reaches = num_reaches(3:end,:);   % first two rows are the means in the graph
mean_num_reaches = mean(num_reaches);
std_num_reaches = std(num_reaches,0,1);
SEM_num_reaches = std_num_reaches / sqrt(size(num_reaches,1));

rats_engaged = num_reaches > numReachThreshold;
for ii = 1 : size(rats_engaged,1)
    first_day = find(rats_engaged(ii,:),1,'first');
    rats_engaged(ii,first_day:end) = 1;
end
num_rats_past_thresh = sum(num_reaches > numReachThreshold,1);
num_rats_engaged = sum(rats_engaged,1);
figure(h_fig)
axes(h_axes(2,1));
errorbar(num_reaches_day,mean_num_reaches,SEM_num_reaches,...
         'color','k',...
         'linewidth',lineWidth,...
         'marker','o',...
         'markersize',markerSize);

ax1_pos = get(h_axes(2,1),'position');
ax2 = axes('units','centimeters',...
           'position',ax1_pos,...
           'xaxislocation','bottom',...
           'yaxislocation','right',...
           'color','none');
plot(num_reaches_day,num_rats_engaged,...
     'color','k',...
     'linewidth',lineWidth,...
     'linestyle','-.',...
     'marker','x',...
     'markersize',markerSize,...
     'color',cdf_color);
set(ax2,'ylim',[0 11],...
        'xlim',[0, max(first_succ_day)+1],...
        'ytick',[0,11],...
        'xtick',[],...
        'fontname',tickLabelFont,...
        'fontsize',tickLabelFontSize,...
        'yaxislocation','right',...
        'color','none',...
        'ycolor',cdf_color);
% hold on
% for ii = 1 : size(num_reaches,1)
%     plot(num_reaches_day,num_reaches(ii,:),...
%         'linestyle','none',...
%         'marker','s',...
%         'markersize',markerSize,...
%         'color',ones(1,3)*0.75)
% end
set(h_axes(2,1),'ylim',[0 100],...
    'xlim',[0, max(num_reaches_day)+1],...
    'xtick',xticks,...
    'ytick',y_ticks_count,...
    'fontname',tickLabelFont,...
    'fontsize',tickLabelFontSize);

axes(h_axes(2,1))
ylabel('# of reaches','fontname',axisLabelFont,'fontsize',axisLabelFontSize);
xlabel('training day','fontname',axisLabelFont,'fontsize',axisLabelFontSize);

axes(ax2)
ylabel('# engaged','fontname',axisLabelFont,'fontsize',axisLabelFontSize,'color',cdf_color);


% examplar number of reach plots
load('/Users/dleventh/Documents/Leventhal lab github/SR_methods_paper/raw_succ_data.mat');
% num_reaches = num_reaches - num_err;

axes(h_axes(1,1))
ratIdx_exemplars = [3,4,10,11];%[2,4,5,11];%[1:size(num_reaches, 2)];
for ii = 1 : length(ratIdx_exemplars)
    plot(1:12, num_reaches(:,ratIdx_exemplars(ii)),...
         'color','k',...
         'linewidth',lineWidth,...
         'marker',indMarkerStyle{ii},...
         'markersize',markerSize,...
         'linestyle',indLineStyle{ii});
     hold on
end

set(gca,'ylim',[0 100],...
        'xlim',[0, max(first_succ_day)+1],...
        'xtick',xticks,...
        'ytick',y_ticks_count,...
        'xticklabel',{},...
        'fontname',tickLabelFont,...
        'fontsize',tickLabelFontSize);
ylabel('# of reaches','fontname',axisLabelFont,'fontsize',axisLabelFontSize);
% xlabel('training day','fontname',axisLabelFont,'fontsize',axisLabelFontSize);

axes(h_axes(1,2))
for ii = 1 : length(ratIdx_exemplars)
    plot(1:12, any_reach_success(:,ratIdx_exemplars(ii)) ./ num_reaches(:,ratIdx_exemplars(ii)),...
         'color','k',...
         'linewidth',lineWidth,...
         'marker',indMarkerStyle{ii},...
         'markersize',markerSize,...
         'linestyle',indLineStyle{ii});
     hold on
end
set(gca,'ylim',[0 1],...
        'xlim',[0, max(first_succ_day)+1],...
        'xtick',xticks,...
        'ytick',yticks_acc,...
        'xticklabel',{},...
        'fontname',tickLabelFont,...
        'fontsize',tickLabelFontSize);
ylabel('success rate','fontname',axisLabelFont,'fontsize',axisLabelFontSize);

figPath = '/Users/dleventh/Box Sync/Leventhal Lab/Manuscripts/Skilled reaching methods/Figures';
pdfName = fullfile(figPath,'SR_trainingResults_rev2');
print(pdfName,'-dpdf');

%%
figProps2.m = 1;
figProps2.n = 2;
figProps2.width = 2.54 * 8.5;
figProps2.height = 2.54 * 11;
panelSize = 3;
figProps2.panelWidth = ones(figProps2.n,1) * panelSize;
figProps2.panelHeight = ones(figProps2.m,1) * panelSize;
figProps2.colSpacing = 1.5;
figProps2.rowSpacing = 1;
figProps2.topMargin = 3;
nr_all = num_reaches(:);
nr_pre = num_reaches(1:11,:);
nr_post = num_reaches(2:12,:);
temp = any_succ';
acc_all = temp(:);
[r,p] = corrcoef(nr_pre,nr_post);

[h_fig2, h_axes2] = createFigPanels5(figProps2);

axes(h_axes2(1,1));
hold on
plot(nr_pre,nr_post,...
         'color','k',...
         'linestyle','-.',...
         'marker','o',...
         'markersize',markerSize,...
         'linestyle','none');
set(gca,'ylim',[0 100],...
        'xlim',[0, 100],...
        'xtick',y_ticks_count,...
        'ytick',y_ticks_count,...
        'fontname',tickLabelFont,...
        'fontsize',tickLabelFontSize);
ylabel('# trials, session n','fontname',axisLabelFont,'fontsize',axisLabelFontSize);
xlabel('# trials, session n-1','fontname',axisLabelFont,'fontsize',axisLabelFontSize);

axes(h_axes2(1,2));
plot(nr_all,acc_all,...
         'color','k',...
         'linestyle','-.',...
         'marker','o',...
         'markersize',markerSize,...
         'linestyle','none');
set(gca,'ylim',[0 1],...
        'xlim',[0, 100],...
        'xtick',y_ticks_count,...
        'ytick',yticks_acc,...
        'fontname',tickLabelFont,...
        'fontsize',tickLabelFontSize);
ylabel('success rate','fontname',axisLabelFont,'fontsize',axisLabelFontSize);
xlabel('# trials','fontname',axisLabelFont,'fontsize',axisLabelFontSize);
pdfName = fullfile(figPath,'SR_training_correlations');
print(pdfName,'-dpdf');
